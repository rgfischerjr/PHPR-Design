{
	"type": "EVENT_BUTTON",
	"name": "Delete",
	"serverCode": "// Put your code here.\n\n// Expecting $keys from ClientBefore (array of selected rows)\n// Adjust field names here to match your schema.\n$ok = true;\n$message = \"\";\n$today = date('Y-m-d');\n\n// If your PK isn't \"id\", set it here:\n$pkName = \"id\";\n\n// If your fields have different names, change here:\n$statusField = \"status\";\n$finishField = \"actual_finish\";\n\n// Optional: permissions check (example)\n// if( !Security::isAdmin() ) { echo my_json_encode([\"ok\"=>false, \"message\"=>\"Not authorized\"]); return; }\n\nforeach ($keys as $k) {\n    // $k is an associative array of PK values for one row (usually 1 key)\n    $rowId = (int)$k[$pkName];\n\n    // Update the row\n    $sql = \"UPDATE design_subphase\n            SET \".$statusField.\"='Done',\n                \".$finishField.\"=\".$_connection->prepareString($today).\"\n            WHERE \".$pkName.\"=\".$rowId;\n\n    if( !DB::Exec($sql) ) {\n        $ok = false;\n        $message = \"DB update failed on ID \".$rowId;\n        break;\n    }\n}\n\n// Return JSON to the ClientBefore callback\necho my_json_encode([ \"ok\" => $ok, \"message\" => $message ]);\n\n",
	"beforeJsCode": "// Put your code here.\n\n// Collect selected subphase IDs\nvar ids = runner.getSelectedKeys();\nif (!ids.length) {\n  swal('Select at least one subphase row first');\n  return false; // cancel button action\n}\n\n// Send to Server event (below)\najaxRequest({\n  action: 'markDone',          // label for your action\n  table: 'design_subphase',    // <-- change if your table name differs\n  keys: ids                    // PHPR passes these to $keys on the Server side\n}, function(resp){\n  if (resp && resp.ok) {\n    // simplest refresh; replace with a partial grid reload if you have one\n    location.reload();\n  } else {\n    swal(resp && resp.message ? resp.message : 'Update failed');\n  }\n});\n\n// prevent default submit\nreturn false;\n",
	"afterJsCode": "// Put your code here.\n\nvar message = result[\"txt\"] + \" !!!\";\najax.setMessage(message);\n"
}